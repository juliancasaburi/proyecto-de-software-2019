{% extends "layout.html" %}
{% block title %}Listado de Estudiantes - {{ siteconfig['titulo'] }}{% endblock %}
{% block head %}
    {{ super() }}
    <meta id="items-per-page" data-ammount="{{ siteconfig['items_por_pagina'] }}">
    <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='css/dataTables.material.min.css') }}" media="screen">
    <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='css/responsive.dataTables.min.css') }}" media="screen">
{% endblock %}

{% block main %}
    <div class="container">
        <div class="section">

            <div class="row">
                <div class="col s12 center">
                    <h1>Listado de Estudiantes</h1>
                </div>
            </div>

            <div class="row">
                <div class="card material-table">
                    <div class="table-header">
                        <span class="table-title">Estudiantes</span>
                        <div class="actions">
                            <a class="tooltipped modal-trigger waves-effect btn-flat nopadding" href="#modalAltaEstudiante" data-position="top" data-tooltip="Crear estudiante"><i class="material-icons">person_add</i></a>
                            <a class="tooltipped modal-trigger btn-flat nopadding" href="#modalFilters" data-position="top" data-tooltip="Filtros">
                                <i class="large material-icons">search</i>
                            </a>
                        </div>
                    </div>
                    <table id="tablaEstudiantes" class="highlight nowrap" style="width:100%">
                        <thead>
                        <tr class="orange">
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Apellido</th>
                            <th>Fecha de nacimiento</th>
                            <th>Localidad</th>
                            <th>Domicilio</th>
                            <th>Barrio</th>
                            <th>Género</th>
                            <th>Tipo de Documento</th>
                            <th>Numero de Documento</th>
                            <th>Número telefónico</th>
                            <th>Escuela</th>
                            <th>Nivel</th>
                        </tr>
                        </thead>
                        <tfoot>
                        <tr class="orange">
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Apellido</th>
                            <th>Fecha de nacimiento</th>
                            <th>Localidad</th>
                            <th>Domicilio</th>
                            <th>Barrio</th>
                            <th>Género</th>
                            <th>Tipo de Documento</th>
                            <th>Número de Documento</th>
                            <th>Número telefónico</th>
                            <th>Escuela</th>
                            <th>Nivel</th>
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

            {% include 'partials/modal_alta_estudiante.html' %}

            <div class="col-md-12 center text-center">
                <span class="left" id="total_reg"></span>
                <ul class="pagination pager" id="pager"></ul>
            </div>

            <div class="fixed-action-btn">
                <a class="btn-floating btn-large tooltipped modal-trigger teal waves-effect waves-light" href="#modalFilters" data-position="left" data-tooltip="Filtros">
                    <i class="large material-icons">search</i>
                </a>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dataTables.responsive.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dataTables.material.min.js') }}"></script>
    <script>
    $(document).ready(function(){
        $('.tooltipped').tooltip();
    });
    </script>
    <script>
        $(document).ready(function() {
            $('#tablaEstudiantes').DataTable( {
                "ajax": {
                    "url": "{{ url_for('estudiante_all') }}",
                    "dataType": "json",
                    "dataSrc": "",
                    "contentType":"application/json"
                },
                "columns": [
                    {"data": "ID"},
                    {"data": "Nombre"},
                    {"data": "Apellido"},
                    {"data": "Fecha de nacimiento"},
                    {"data": "Localidad"},
                    {"data": "Domicilio"},
                    {"data": "Barrio"},
                    {"data": "Género"},
                    {"data": "Tipo de documento"},
                    {"data": "Número de documento"},
                    {"data": "Número telefónico"},
                    {"data": "Escuela"},
                    {"data": "Nivel"}
                ],
                "language": {
                    "paginate": {
                        "first":      "Primera",
                        "last":       "Última",
                        "next":       "Siguiente",
                        "previous":   "Anterior"
                    },
                    "info":           "Mostrando resultados <b>_START_</b> al <b>_END_</b> de un total de <b>_TOTAL_</b>",
                    "infoFiltered": "<br>(<b>_MAX_ sin filtrar</b>)"
                },
                "columnDefs": [
                    { "orderable": false, "targets": 'nosort' } // Disable sorting for column 9
                ],
                sDom: 't,i,p', // Hide info
                pageLength: $('#items-per-page').data("ammount"),
                "scrollX": true
            } );
            setInterval( function () {
                var table = $('#tablaEstudiantes').DataTable();
                table.ajax.reload( null, false ); // user paging is not reset on reload
            }, 5000 );
        } );
    </script>
    <script> // Alta de Estudiante
    $(document).ready(function(){
        $('#modalAltaEstudiante').modal();
        $('select').formSelect();
    });
    </script>
{% endblock %}